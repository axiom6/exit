// Generated by CoffeeScript 1.9.1
(function() {
  var UI,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  UI = (function() {
    Util.Export(UI, 'ui/UI');

    UI.IconSpecs = [
      {
        name: 'Destination',
        css: 'Icon',
        icon: 'picture-o'
      }, {
        name: 'Recommendation',
        css: 'Icon',
        icon: 'thumbs-up'
      }, {
        name: 'Trip',
        css: 'Icon',
        icon: 'road'
      }, {
        name: 'Deals',
        css: 'Icon',
        icon: 'trophy'
      }, {
        name: 'Navigate',
        css: 'Icon',
        icon: 'car'
      }, {
        name: 'Point',
        css: 'Icon',
        icon: 'compass'
      }, {
        name: 'Fork',
        css: 'Icon',
        icon: 'code-fork'
      }
    ];

    function UI(stream, destinationUI, goUI, tripUI, dealsUI, navigateUI) {
      var IconsUC;
      this.stream = stream;
      this.destinationUI = destinationUI;
      this.goUI = goUI;
      this.tripUI = tripUI;
      this.dealsUI = dealsUI;
      this.navigateUI = navigateUI;
      this.onIcons = bind(this.onIcons, this);
      IconsUC = Util.Import('uc/IconsUC');
      this.iconsUC = new IconsUC(this.stream, 'Icons', [0, 0, 100, 10], [0, 0, 100, 18], UI.IconSpecs, true, true);
      this.orientation = 'Portrait';
      this.recommendation = '?';
    }

    UI.prototype.ready = function() {
      this.$ = $(this.html());
      $('#App').append(this.$);
      this.iconsUC.ready();
      this.destinationUI.ready();
      this.goUI.ready();
      this.tripUI.ready();
      this.dealsUI.ready();
      this.navigateUI.ready();
      this.$.append(this.iconsUC.$);
      this.$view = this.$.find('#View');
      this.$view.append(this.destinationUI.$);
      this.$view.append(this.goUI.$);
      this.$view.append(this.tripUI.$);
      this.$view.append(this.dealsUI.$);
      this.$view.append(this.navigateUI.$);
      this.subscribe();
      return this.stream.publish('Icons', 'Destination');
    };

    UI.prototype.position = function(screen) {
      this.onScreen(screen);
      this.iconsUC.position(screen);
      this.destinationUI.position(screen);
      this.goUI.position(screen);
      this.tripUI.position(screen);
      this.dealsUI.position(screen);
      return this.navigateUI.position(screen);
    };

    UI.prototype.subscribe = function() {
      this.stream.subscribe('Icons', (function(_this) {
        return function(name) {
          return _this.onIcons(name);
        };
      })(this));
      this.stream.subscribe('Screen', (function(_this) {
        return function(screen) {
          return _this.onScreen(screen);
        };
      })(this));
      return this.stream.subscribe('Trip', (function(_this) {
        return function(trip) {
          return _this.onTrip(trip);
        };
      })(this));
    };

    UI.prototype.id = function(name, type) {
      return Util.id(name, type);
    };

    UI.prototype.css = function(name, type) {
      return Util.css(name, type);
    };

    UI.prototype.icon = function(name, type, fa) {
      return Util.icon(name, type, fa);
    };

    UI.prototype.html = function() {
      return "<div   id=\"" + (this.id('UI')) + "\"   class=\"" + (this.css('UI')) + "\">\n <div id=\"" + (this.id('View')) + "\" class=\"" + (this.css('View')) + "\"></div>\n</div>";
    };

    UI.prototype.onTrip = function(trip) {
      if (this.recommendation !== trip.recommendation) {
        this.changeRecommendation(trip.recommendation);
      }
    };

    UI.prototype.reverseRecommendation = function() {
      if (this.recommendation === 'GO') {
        return 'NO GO';
      } else {
        return 'GO';
      }
    };

    UI.prototype.reverseOrientation = function() {
      if (this.orientation === 'Portrait') {
        return 'Landscape';
      } else {
        return 'Portrait';
      }
    };

    UI.prototype.changeRecommendation = function(recommendation) {
      var $icon, faClass;
      this.onIcons('Recommendation');
      faClass = recommendation === 'GO' ? 'fa fa-thumbs-up' : 'fa fa-thumbs-down';
      $icon = this.iconsUC.$find('Recommendation');
      $icon.find('i').attr('class', faClass);
      $icon.find('div').text(recommendation);
      this.goUI.bannerUC.changeRecommendation(recommendation);
      this.recommendation = recommendation;
    };

    UI.prototype.onScreen = function(screen) {
      var url;
      if (this.orientation !== screen.orientation) {
        this.orientation = screen.orientation;
        url = "css/img/app/phone6x12" + screen.orientation + ".png";
        $('body').css({
          "background-image": "url(" + url + ")"
        });
        return $('#App').attr('class', "App" + screen.orientation);
      }
    };

    UI.prototype.onIcons = function(name) {
      if (this.lastSelect != null) {
        this.lastSelect.hide();
      }
      switch (name) {
        case 'Destination':
          this.lastSelect = this.destinationUI;
          break;
        case 'Recommendation':
          this.lastSelect = this.goUI;
          break;
        case 'Trip':
          this.lastSelect = this.tripUI;
          break;
        case 'Deals':
          this.lastSelect = this.dealsUI;
          break;
        case 'Navigate':
          this.lastSelect = this.navigateUI;
          break;
        case 'Fork':
          this.changeRecommendation(this.reverseRecommendation());
          break;
        case 'Point':
          this.stream.publish('Screen', this.toScreen(this.reverseOrientation()));
          break;
        default:
          Util.error("UI.select unknown name", name);
      }
      this.lastSelect.show();
    };

    UI.prototype.width = function() {
      return this.$.width();
    };

    UI.prototype.height = function() {
      return this.$.height();
    };

    UI.prototype.toScreen = function(orientation) {
      if (orientation === this.orientation) {
        return {
          orientation: orientation,
          width: this.width(),
          height: this.height()
        };
      } else {
        return {
          orientation: orientation,
          width: this.height(),
          height: this.width()
        };
      }
    };

    return UI;

  })();

}).call(this);
